<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-LinOSS Web Demo - Real Burn Integration</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .demo-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        button:active {
            transform: translateY(0);
        }
        input[type="number"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 16px;
            width: 120px;
        }
        input[type="number"]::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .output {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 20px 0;
            min-height: 100px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status {
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid rgba(40, 167, 69, 0.5);
        }
        .error {
            background: rgba(220, 53, 69, 0.3);
            border-color: rgba(220, 53, 69, 0.5);
        }
        .tensor-viz {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .tensor-value {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-family: monospace;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧠 D-LinOSS Web Demo</h1>
        <p style="text-align: center; font-size: 1.2em; margin-bottom: 30px;">
            Real Neural Dynamics with Burn Framework in WebAssembly
        </p>

        <div class="demo-section">
            <h3>🔧 Burn Tensor Operations</h3>
            <div class="controls">
                <button onclick="testBurnTensors()">Test Burn Tensors</button>
                <button onclick="runTensorMath()">Tensor Math Demo</button>
                <button onclick="generateRandomInput()">Random Input</button>
                <input type="number" id="inputSize" placeholder="Input size" value="10" min="1" max="50">
            </div>
            <div class="status" id="status">Ready - Click a button to test Burn WASM integration</div>
            <div class="output" id="output">Waiting for WASM module to load...</div>
        </div>

        <div class="demo-section">
            <h3>📊 Input Visualization</h3>
            <div class="tensor-viz" id="inputViz"></div>
        </div>

        <div class="demo-section">
            <h3>📈 Output Visualization</h3>
            <div class="tensor-viz" id="outputViz"></div>
        </div>
    </div>

    <script type="module">
        import init, { DLinOSSDemo } from './pkg/linoss_web_demo.js';
        
        let demo = null;
        let wasmReady = false;

        // Global functions for button handlers
        window.testBurnTensors = testBurnTensors;
        window.runTensorMath = runTensorMath;
        window.generateRandomInput = generateRandomInput;

        async function initDemo() {
            try {
                await init();
                demo = new DLinOSSDemo();
                wasmReady = true;
                
                updateStatus("✅ D-LinOSS WASM Demo Ready!", false);
                updateOutput("WASM module loaded successfully!\n\n" + demo.get_info());
            } catch (error) {
                updateStatus("❌ Failed to initialize WASM: " + error.message, true);
                updateOutput("Error loading WASM module: " + error);
            }
        }

        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = isError ? 'status error' : 'status';
        }

        function updateOutput(text) {
            document.getElementById('output').textContent = text;
        }

        function visualizeTensor(values, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            values.forEach((value, index) => {
                const div = document.createElement('div');
                div.className = 'tensor-value';
                div.textContent = `[${index}] ${value.toFixed(4)}`;
                container.appendChild(div);
            });
        }

        function testBurnTensors() {
            if (!wasmReady) {
                updateStatus("❌ WASM not ready yet", true);
                return;
            }

            try {
                updateStatus("🔄 Running Burn tensor operations...", false);
                
                const inputSize = parseInt(document.getElementById('inputSize').value) || 10;
                const input = Array.from({length: inputSize}, (_, i) => Math.sin(i * 0.5) + Math.cos(i * 0.3));
                
                visualizeTensor(input, 'inputViz');
                
                const startTime = performance.now();
                const output = demo.forward(input);
                const duration = performance.now() - startTime;
                
                visualizeTensor(output, 'outputViz');
                
                updateStatus(`✅ Burn processing complete in ${duration.toFixed(2)}ms`, false);
                updateOutput(
                    `Burn Tensor Processing Results:\n` +
                    `Input size: ${input.length}\n` +
                    `Output size: ${output.length}\n` +
                    `Processing time: ${duration.toFixed(2)}ms\n\n` +
                    `Input sample: [${input.slice(0, 5).map(x => x.toFixed(3)).join(', ')}...]\n` +
                    `Output sample: [${output.slice(0, 5).map(x => x.toFixed(3)).join(', ')}...]\n\n` +
                    demo.get_info()
                );
            } catch (error) {
                updateStatus("❌ Error in tensor processing: " + error.message, true);
                updateOutput("Error: " + error);
            }
        }

        function runTensorMath() {
            if (!wasmReady) {
                updateStatus("❌ WASM not ready yet", true);
                return;
            }

            try {
                updateStatus("🧮 Running advanced tensor math...", false);
                
                // Create a more complex input pattern
                const input = Array.from({length: 10}, (_, i) => {
                    return Math.sin(i * Math.PI / 5) * Math.cos(i * Math.PI / 3) + Math.random() * 0.1;
                });
                
                visualizeTensor(input, 'inputViz');
                
                const results = [];
                const iterations = 5;
                
                for (let i = 0; i < iterations; i++) {
                    const startTime = performance.now();
                    const output = demo.forward(input);
                    const duration = performance.now() - startTime;
                    results.push({output, duration});
                    
                    // Use output as next input for chaining
                    if (output.length >= input.length) {
                        input.splice(0, input.length, ...output.slice(0, input.length));
                    }
                }
                
                const finalOutput = results[results.length - 1].output;
                const avgTime = results.reduce((sum, r) => sum + r.duration, 0) / results.length;
                
                visualizeTensor(finalOutput, 'outputViz');
                
                updateStatus(`✅ Completed ${iterations} iterations, avg ${avgTime.toFixed(2)}ms`, false);
                updateOutput(
                    `Advanced Tensor Math Results:\n` +
                    `Iterations: ${iterations}\n` +
                    `Average processing time: ${avgTime.toFixed(2)}ms\n` +
                    `Final output: [${finalOutput.slice(0, 8).map(x => x.toFixed(3)).join(', ')}...]\n\n` +
                    `Performance per iteration:\n` +
                    results.map((r, i) => `  ${i+1}: ${r.duration.toFixed(2)}ms`).join('\n') +
                    `\n\n${demo.get_info()}`
                );
            } catch (error) {
                updateStatus("❌ Error in tensor math: " + error.message, true);
                updateOutput("Error: " + error);
            }
        }

        function generateRandomInput() {
            const inputSize = parseInt(document.getElementById('inputSize').value) || 10;
            const randomInput = Array.from({length: inputSize}, () => (Math.random() - 0.5) * 2);
            
            visualizeTensor(randomInput, 'inputViz');
            document.getElementById('outputViz').innerHTML = '<div style="color: #888; font-style: italic;">Click "Test Burn Tensors" to see output</div>';
            
            updateStatus(`🎲 Generated ${inputSize} random values`, false);
            updateOutput(
                `Random Input Generated:\n` +
                `Size: ${inputSize}\n` +
                `Range: [-1, 1]\n` +
                `Values: [${randomInput.slice(0, 10).map(x => x.toFixed(3)).join(', ')}${inputSize > 10 ? '...' : ''}]\n\n` +
                `Click "Test Burn Tensors" to process this input!`
            );
        }

        // Initialize when page loads
        initDemo();
    </script>
</body>
</html>
